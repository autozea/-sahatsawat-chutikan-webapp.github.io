<!DOCTYPE html>
<html>
  <head>
    <title>Covid Stats 2021</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="./styles/region.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
    />
  </head>

  <body>
    <!-- Header -->
    <div class="header">
      <h1>COVID 19 STATS IN THAILAND</h1>
    </div>

    <!-- Navigation Bar -->
    <div class="navbar">
      <a href="index.html">หน้าหลัก</a>
      <div class="dropbtn">
        <div class="dropdown">
          <a class="dropbtn">ภูมิภาค</a>
          <div class="dropdown-content">
            <a href="./region-north.html">ภาคเหนือ</a>
            <a href="./region-easten.html">ภาคตะวันออก</a>
            <a href="./region-northeast.html">ตะวันออกเฉียงเหนือ</a>
            <a href="./region-central.html">ภาคกลาง</a>
            <a href="./region-westen.html">ภาคตะวันตก</a>
            <a href="./region-south.html">ภาคใต้</a>
          </div>
        </div>
      </div>
    </div>
    <div>
      <h2>สถานการณ์ในภาค<span> ใต้</span></h2>
    </div>
    <div class="rectangle" id="covid-status-main">
      <div id="covid-status">
        <div>
          <p class="covid-status-title">ติดเชื้อเพิ่มวันนี้</p>
          <p class="covid-status-stats" style="color: #ff2928">
            +<span id="sum_today">0</span>
          </p>
        </div>
        <div>
          <p class="covid-status-title">เสียชีวิตเพิ่มวันนี้</p>
          <p class="covid-status-stats"><span id="sum_today_death">0</span></p>
        </div>
      </div>
      <div class="vl" id="covid-status">
        <div>
          <p class="covid-status-title">หายป่วยกลับบ้าน</p>
          <p class="covid-status-stats" style="color: #005838">
            +<span id="happy">0</span>
          </p>
        </div>
        <div>
          <p class="covid-status-title">เสียชีวิตสะสม</p>
          <p class="covid-status-stats" style="color: #ff2928">
            <span id="sum_total_death">0</span>
          </p>
        </div>
      </div>
      <div class="vl" id="covid-status">
        <div>
          <p class="covid-status-title">กำลังรักษา</p>
          <p class="covid-status-stats" style="color: #ffd300">
            <span id="healing_case">0</span>
          </p>
        </div>
        <div>
          <p class="covid-status-title">ผู้ป่วยสะสม</p>
          <p class="covid-status-stats"><span id="sum_total_case">0</span></p>
        </div>
      </div>
    </div>

    <div class="search-container">
      <input
        type="text"
        id="myInput"
        onkeyup="myFunction()"
        placeholder="ค้นหาจังหวัด.."
        title="search"
        style="border-radius: 10px"
      />
      <i class="fa fa-search fa-lg"></i>
    </div>
    <div class="rectangle" style="text-align: left; border-color: #007662">
      <ul id="myUL"></ul>
    </div>

    <script src="./scripts/search-cont.js"></script>
    <script>
      fetch(
        "https://api-lab-covid.mindbase.co.th/v2/stats/provinces/daily?key=2f082573-f921-4441-9838-202108a3f4b5116e9c"
      )
        .then((response) => {
          return response.json();
        })
        .then((data) => {
          var ul = document.getElementById("myUL");
          ul.style.listStyleType = "none";

          list_south_no = [
            "45",
            "37",
            "43",
            "18",
            "49",
            "68",
            "53",
            "58",
            "76",
            "47",
            "59",
            "26",
            "64",
            "6",
          ];
          let sum_today = 0;
          data.data.provinces.forEach((province) => {
            if (list_south_no.includes(province.no)) {
              var li = document.createElement("li");
              var today_sum = document.getElementById("sum_today");
              sum_today += province.count;
              today_sum.innerHTML = sum_today;
              li.innerHTML = `<a href="#">${province.name_th}</a>`;
              ul.appendChild(li);
              // console.log(province.count);
            }
          });
        })
        .catch((err) => {
          console.log(err);
        });
    </script>

    <script>
      fetch("https://covid19.ddc.moph.go.th/api/Cases/today-cases-by-provinces")
        .then((response) => {
          return response.json();
        })
        .then((data) => {
          list_south_name = [
            "สงขลา",
            "นครศรีธรรมราช",
            "ยะลา",
            "ปัตตานี",
            "นราธิวาส",
            "สุราษฎร์ธานี",
            "ตรัง",
            "สตูล",
            "ภูเก็ต",
            "ชุมพร",
            "กระบี่",
            "พังงา",
            "พัทลุง",
            "ระนอง",
          ];
          var array = [];
          for (let i = 0; i < data.length - 1; i++) {
            var li = document.createElement("li");
            var province = data[i].province;
            li.innerHTML += province;
            array.push(province);
          }

          let sum_total_case = 0;
          let sum_today_death = 0;
          let sum_total_death = 0;
          data.forEach((south_name) => {
            // console.log(array.includes(south_name));
            if (list_south_name.includes(south_name.province)) {
              //calculate sum_total_case ผู้ป่วยสะสม
              var today_total_case = document.getElementById("sum_total_case");
              sum_total_case += south_name.total_case;
              today_total_case.innerHTML = sum_total_case;
              console.log(sum_total_case);

              //calculate sum_today_death เสียชีวิตเพิ่มวันนี้
              var today_death = document.getElementById("sum_today_death");
              sum_today_death += south_name.new_death;
              today_death.innerHTML = sum_today_death;

              //calculate sum_total_death เสียชีวิตสะสม
              var today_total_death =
                document.getElementById("sum_total_death");
              sum_total_death += south_name.total_death;
              today_total_death.innerHTML = sum_total_death;
            }
          });
        })

        .catch((err) => {
          console.log(err);
        });
    </script>
  </body>
</html>
